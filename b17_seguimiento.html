<!DOCTYPE html>
<html lang="es">
<head>
    <title>Seguimiento - Helader√≠a Deliciosa</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .tracking-step {
            text-align: center;
            padding: 15px;
            position: relative;
        }
        .tracking-step.completed {
            color: #198754;
        }
        .tracking-step.active {
            color: #0d6efd;
            font-weight: bold;
        }
        .tracking-step.pending {
            color: #6c757d;
        }
        .progress-line {
            height: 4px;
            background: #dee2e6;
            margin: 0 10px;
        }
        .progress-line.completed {
            background: #198754;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">üç¶ Helader√≠a Deliciosa</a>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10">

                <!-- Header -->
                <div class="row mb-4">
                    <div class="col-12 text-center">
                        <h1 class="display-4 text-primary">Seguimiento del Pedido</h1>
                        <p class="lead text-muted">Revisa el estado de tu pedido en tiempo real</p>
                    </div>
                </div>

                <!-- Estado general del pedido -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="alert alert-info text-center shadow-sm">
                            <h5 class="mb-2" id="orderStatus">Preparando tu pedido</h5>
                            <p class="mb-0" id="statusDescription">Tu helado est√° siendo preparado con ingredientes frescos</p>
                        </div>
                    </div>
                </div>

                <!-- Informaci√≥n del pedido -->
                <div class="row mb-4">
                    <div class="col-12 col-md-6">
                        <div class="card border shadow-sm">
                            <div class="card-header bg-light text-center fw-semibold">
                                üìã Informaci√≥n del Pedido
                            </div>
                            <div class="card-body">
                                <div class="row mb-2">
                                    <div class="col-12 mb-2">
                                        <strong>N√∫mero de Pedido:</strong><br>
                                        <span id="trackingNumber">HD-${Date.now().toString().slice(-6)}</span>
                                    </div>
                                    <div class="col-12 mb-2">
                                        <strong>Fecha del Pedido:</strong><br>
                                        <span>${new Date().toLocaleDateString()}</span>
                                    </div>
                                    <div class="col-12 mb-2">
                                        <strong>M√©todo de Entrega:</strong><br>
                                        <span id="deliveryMethod">Retiro en tienda</span>
                                    </div>
                                    <div class="col-12">
                                        <strong>Total:</strong><br>
                                        <span class="fw-bold text-success">$<span id="orderTotal">0</span></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6 mt-3 mt-md-0">
                        <div class="card border shadow-sm">
                            <div class="card-header bg-light text-center fw-semibold">
                                üë§ Informaci√≥n de Contacto
                            </div>
                            <div class="card-body">
                                <div class="row mb-2">
                                    <div class="col-12 mb-2">
                                        <strong>Cliente:</strong><br>
                                        <span id="customerName">Nombre del Cliente</span>
                                    </div>
                                    <div class="col-12 mb-2">
                                        <strong>Email:</strong><br>
                                        <span id="customerEmail">cliente@email.com</span>
                                    </div>
                                    <div class="col-12 mb-2">
                                        <strong>Tel√©fono:</strong><br>
                                        <span>+56 9 1234 5678</span>
                                    </div>
                                    <div class="col-12">
                                        <strong>Direcci√≥n:</strong><br>
                                        <span id="deliveryAddress">Calle Principal 123, Santiago</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- L√≠nea de progreso -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border shadow-sm">
                            <div class="card-header bg-light text-center fw-semibold">
                                üìà Progreso del Pedido
                            </div>
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <!-- Paso 1: Confirmado -->
                                    <div class="col tracking-step completed">
                                        <div class="h4">‚úÖ</div>
                                        <small>Confirmado</small>
                                        <div class="small text-muted" id="step1Time">Hace 5 min</div>
                                    </div>
                                    <div class="col-1 progress-line completed"></div>
                                    
                                    <!-- Paso 2: En Preparaci√≥n -->
                                    <div class="col tracking-step active">
                                        <div class="h4">üë®‚Äçüç≥</div>
                                        <small>En Preparaci√≥n</small>
                                        <div class="small text-muted" id="step2Time">En progreso</div>
                                    </div>
                                    <div class="col-1 progress-line"></div>
                                    
                                    <!-- Paso 3: Listo -->
                                    <div class="col tracking-step pending">
                                        <div class="h4">‚è∞</div>
                                        <small>Listo</small>
                                        <div class="small text-muted" id="step3Time">-</div>
                                    </div>
                                    <div class="col-1 progress-line"></div>
                                    
                                    <!-- Paso 4: Entregado -->
                                    <div class="col tracking-step pending">
                                        <div class="h4">üéâ</div>
                                        <small>Entregado</small>
                                        <div class="small text-muted" id="step4Time">-</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Estado detallado del pedido -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border shadow-sm">
                            <div class="card-header bg-secondary bg-opacity-10 text-center fw-semibold">
                                üìù Historial de Actualizaciones
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-12 col-md-6 mb-2">
                                        <strong>üïí Hora Estimada de Entrega:</strong><br>
                                        <span id="estimatedTime">${new Date(Date.now() + 45*60*1000).toLocaleTimeString()}</span>
                                    </div>
                                    <div class="col-12 col-md-6 mb-2">
                                        <strong>üë®‚Äçüç≥ Chef Asignado:</strong><br>
                                        <span>Mar√≠a Gonz√°lez</span>
                                    </div>
                                    <div class="col-12 col-md-6 mb-2">
                                        <strong>üöö Repartidor:</strong><br>
                                        <span id="deliveryPerson">Por asignar</span>
                                    </div>
                                    <div class="col-12 col-md-6 mb-2">
                                        <strong>üìû Contacto Repartidor:</strong><br>
                                        <span id="deliveryPhone">-</span>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12 text-center small text-muted">
                                        <div>√öltima actualizaci√≥n: <span id="lastUpdate">${new Date().toLocaleTimeString()}</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mapa del seguimiento -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border shadow-sm">
                            <div class="card-body text-center">
                                <div class="mb-2">
                                    <h6>üó∫Ô∏è Ubicaci√≥n en Tiempo Real</h6>
                                </div>
                                <div class="map-placeholder p-5 bg-light border rounded">
                                    <div class="h1">üó∫Ô∏è</div>
                                    <p class="text-muted">Mapa de seguimiento en tiempo real</p>
                                    <div class="progress mb-2">
                                        <div class="progress-bar" role="progressbar" style="width: 40%"></div>
                                    </div>
                                    <small class="text-muted">Tu pedido est√° en camino al punto de entrega</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botones de acci√≥n -->
                <div class="row mb-4">
                    <div class="col-12 d-flex flex-wrap justify-content-center gap-3">
                        <button class="btn btn-outline-secondary" onclick="refreshTracking()">
                            üîÑ Actualizar
                        </button>
                        <button class="btn btn-primary" onclick="contactSupport()">
                            üìû Contactar Soporte
                        </button>
                        <button class="btn btn-success" onclick="viewOrderDetails()">
                            üìã Ver Detalles del Pedido
                        </button>
                    </div>
                </div>

                <!-- Contacto con el repartidor -->
                <div class="row">
                    <div class="col-12">
                        <div class="card bg-light border">
                            <div class="card-body text-center">
                                <div class="row mb-2">
                                    <div class="col-12">
                                        <h6>üöö ¬øNecesitas contactar al repartidor?</h6>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12 d-flex justify-content-center gap-2 flex-wrap">
                                        <button class="btn btn-outline-primary" onclick="callDelivery()">
                                            üìû Llamar al Repartidor
                                        </button>
                                        <button class="btn btn-outline-danger" onclick="sendMessage()">
                                            üí¨ Enviar Mensaje
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Simular datos de seguimiento
        const trackingData = {
            status: 'preparing',
            steps: {
                confirmed: { completed: true, time: new Date(Date.now() - 5*60*1000) },
                preparing: { completed: false, time: null, active: true },
                ready: { completed: false, time: null },
                delivered: { completed: false, time: null }
            },
            estimatedDelivery: new Date(Date.now() + 45*60*1000),
            chef: 'Mar√≠a Gonz√°lez',
            deliveryPerson: null,
            lastUpdate: new Date()
        };

        document.addEventListener('DOMContentLoaded', function() {
            loadTrackingInfo();
            startTrackingSimulation();
        });

        function loadTrackingInfo() {
            // Cargar informaci√≥n del usuario
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                document.getElementById('customerName').textContent = currentUser;
                document.getElementById('customerEmail').textContent = currentUser + '@email.com';
            }

            // Cargar informaci√≥n de env√≠o
            const shippingInfo = JSON.parse(localStorage.getItem('shippingInfo'));
            if (shippingInfo) {
                document.getElementById('deliveryMethod').textContent = 
                    shippingInfo.type === 'delivery' ? 'Despacho a domicilio' : 'Retiro en tienda';
                
                if (shippingInfo.type === 'delivery' && shippingInfo.address) {
                    document.getElementById('deliveryAddress').textContent = shippingInfo.address;
                }
            }

            // Cargar total del pedido
            const lastOrderTotal = localStorage.getItem('lastOrderTotal');
            if (lastOrderTotal) {
                document.getElementById('orderTotal').textContent = parseInt(lastOrderTotal).toLocaleString();
            }

            updateTrackingDisplay();
        }

        function updateTrackingDisplay() {
            // Actualizar estado general
            const statusElement = document.getElementById('orderStatus');
            const descriptionElement = document.getElementById('statusDescription');
            
            switch(trackingData.status) {
                case 'confirmed':
                    statusElement.textContent = 'Pedido Confirmado';
                    descriptionElement.textContent = 'Hemos recibido tu pedido y lo estamos preparando';
                    break;
                case 'preparing':
                    statusElement.textContent = 'En Preparaci√≥n';
                    descriptionElement.textContent = 'Tu helado est√° siendo preparado con ingredientes frescos';
                    break;
                case 'ready':
                    statusElement.textContent = 'Listo para Entrega';
                    descriptionElement.textContent = 'Tu pedido est√° listo para ser entregado';
                    break;
                case 'delivered':
                    statusElement.textContent = 'Entregado';
                    descriptionElement.textContent = '¬°Disfruta de tu helado!';
                    break;
            }

            // Actualizar tiempos de los pasos
            document.getElementById('step1Time').textContent = 
                trackingData.steps.confirmed.time ? `Hace ${getTimeAgo(trackingData.steps.confirmed.time)}` : '-';
            
            document.getElementById('step2Time').textContent = 
                trackingData.steps.preparing.active ? 'En progreso' : 
                trackingData.steps.preparing.time ? `Hace ${getTimeAgo(trackingData.steps.preparing.time)}` : '-';
            
            document.getElementById('step3Time').textContent = 
                trackingData.steps.ready.time ? `Hace ${getTimeAgo(trackingData.steps.ready.time)}` : '-';
            
            document.getElementById('step4Time').textContent = 
                trackingData.steps.delivered.time ? `Hace ${getTimeAgo(trackingData.steps.delivered.time)}` : '-';

            // Actualizar hora estimada
            document.getElementById('estimatedTime').textContent = 
                trackingData.estimatedDelivery.toLocaleTimeString();

            // Actualizar √∫ltima actualizaci√≥n
            document.getElementById('lastUpdate').textContent = 
                trackingData.lastUpdate.toLocaleTimeString();
        }

        function getTimeAgo(date) {
            const diff = Math.floor((new Date() - date) / 1000 / 60); // diferencia en minutos
            if (diff < 1) return 'unos segundos';
            if (diff < 60) return `${diff} min`;
            return `${Math.floor(diff / 60)} h`;
        }

        function startTrackingSimulation() {
            // Simular avance del pedido cada 30 segundos
            setInterval(() => {
                if (trackingData.status === 'confirmed') {
                    trackingData.status = 'preparing';
                    trackingData.steps.preparing.active = true;
                } else if (trackingData.status === 'preparing') {
                    trackingData.status = 'ready';
                    trackingData.steps.preparing.completed = true;
                    trackingData.steps.preparing.active = false;
                    trackingData.steps.preparing.time = new Date();
                    trackingData.steps.ready.active = true;
                    trackingData.deliveryPerson = 'Carlos Mart√≠nez';
                    document.getElementById('deliveryPerson').textContent = 'Carlos Mart√≠nez';
                    document.getElementById('deliveryPhone').textContent = '+56 9 8765 4321';
                } else if (trackingData.status === 'ready') {
                    trackingData.status = 'delivered';
                    trackingData.steps.ready.completed = true;
                    trackingData.steps.ready.active = false;
                    trackingData.steps.ready.time = new Date();
                    trackingData.steps.delivered.completed = true;
                    trackingData.steps.delivered.time = new Date();
                }
                
                trackingData.lastUpdate = new Date();
                updateTrackingDisplay();
            }, 30000); // 30 segundos
        }

        function refreshTracking() {
            trackingData.lastUpdate = new Date();
            updateTrackingDisplay();
            alert('‚úÖ Informaci√≥n actualizada');
        }

        function contactSupport() {
            alert('üìû Contactando al soporte...\n\nN√∫mero: +56 9 1234 5678\nEmail: soporte@heladeriadeliciosa.cl');
        }

        function viewOrderDetails() {
            alert('üìã Abriendo detalles completos del pedido...');
            // En una implementaci√≥n real, esto mostrar√≠a un modal o redirigir√≠a a otra p√°gina
        }

        function callDelivery() {
            if (trackingData.deliveryPerson) {
                alert(`üìû Llamando a ${trackingData.deliveryPerson}...\n\nN√∫mero: +56 9 8765 4321`);
            } else {
                alert('El repartidor a√∫n no ha sido asignado. Por favor, intenta m√°s tarde.');
            }
        }

        function sendMessage() {
            if (trackingData.deliveryPerson) {
                const message = prompt(`üí¨ Escribe tu mensaje para ${trackingData.deliveryPerson}:`);
                if (message) {
                    alert(`‚úÖ Mensaje enviado: "${message}"`);
                }
            } else {
                alert('El repartidor a√∫n no ha sido asignado. Por favor, intenta m√°s tarde.');
            }
        }
    </script>
</body>
</html>