<!DOCTYPE html>
<html lang="es">
<head>
    <title>Pago - Helader√≠a Deliciosa</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="index.html">üç¶ Helader√≠a Deliciosa</a>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10 col-lg-8">

                <!-- Header -->
                <div class="row mb-4">
                    <div class="col-12 text-center">
                        <h1 class="display-4 text-primary">Proceso de Pago</h1>
                        <p class="lead text-muted">Completa tu compra de forma segura</p>
                    </div>
                </div>

                <!-- T√≠tulo -->
                <div class="row mb-4">
                    <div class="col-12 text-center">
                        <div class="alert alert-info">
                            <h5 class="mb-0">üí≥ Selecciona tu m√©todo de pago preferido</h5>
                        </div>
                    </div>
                </div>

                <!-- Resumen del pedido -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card shadow-sm">
                            <div class="card-header bg-light">
                                <h5 class="mb-0">üì¶ Resumen de tu Pedido</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-12 col-md-6 mb-2">
                                        <strong>N√∫mero de Pedido:</strong><br>
                                        <span id="orderNumber"></span>
                                    </div>
                                    <div class="col-12 col-md-6 mb-2">
                                        <strong>Fecha:</strong><br>
                                        <span id="orderDate"></span>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-12 col-md-6 mb-2">
                                        <strong>Subtotal:</strong><br>
                                        <span>$<span id="orderSubtotal">0</span></span>
                                    </div>
                                    <div class="col-12 col-md-6 mb-2">
                                        <strong>Env√≠o:</strong><br>
                                        <span>$<span id="orderShipping">0</span></span>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-12 text-end">
                                        <h5 class="text-success">Total: $<span id="orderTotal">0</span></h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Selecci√≥n del m√©todo de pago -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border">
                            <div class="card-header bg-light">
                                <h5 class="mb-0 text-center">üí≥ M√©todo de Pago</h5>
                            </div>
                            <div class="card-body">
                                <div class="row mb-3">
                                    <div class="col-12 col-md-6 mb-3 d-flex align-items-center">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="metodoPago" id="bancoLocal" checked>
                                            <label class="form-check-label" for="bancoLocal">
                                                <strong>Tarjeta de Cr√©dito/D√©bito</strong><br>
                                                <small class="text-muted">Pago seguro con tarjeta</small>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-12 col-md-6 mb-3 d-flex align-items-center">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="metodoPago" id="tarjetaLocal">
                                            <label class="form-check-label" for="tarjetaLocal">
                                                <strong>Transferencia Bancaria</strong><br>
                                                <small class="text-muted">Transferencia directa</small>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-12 col-md-6 mb-3 d-flex align-items-center">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="metodoPago" id="transferencia">
                                            <label class="form-check-label" for="transferencia">
                                                <strong>Mercado Pago</strong><br>
                                                <small class="text-muted">Pago con QR o link</small>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-12 col-md-6 mb-3 d-flex align-items-center">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="metodoPago" id="efectivo">
                                            <label class="form-check-label" for="efectivo">
                                                <strong>Efectivo</strong><br>
                                                <small class="text-muted">Pago al retirar</small>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Formulario de tarjeta (visible por defecto) -->
                                <div class="row mb-3" id="creditCardForm">
                                    <div class="col-12">
                                        <h6>Informaci√≥n de la Tarjeta</h6>
                                        <div class="row">
                                            <div class="col-12 mb-3">
                                                <label class="form-label">N√∫mero de Tarjeta</label>
                                                <input type="text" class="form-control" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
                                                <div class="invalid-feedback" id="cardNumberError">Por favor ingresa un n√∫mero de tarjeta v√°lido</div>
                                            </div>
                                            <div class="col-6 mb-3">
                                                <label class="form-label">Fecha de Vencimiento</label>
                                                <input type="text" class="form-control" id="cardExpiry" placeholder="MM/AA">
                                                <div class="invalid-feedback" id="cardExpiryError">Formato inv√°lido (MM/AA)</div>
                                            </div>
                                            <div class="col-6 mb-3">
                                                <label class="form-label">CVV</label>
                                                <input type="text" class="form-control" id="cardCVV" placeholder="123" maxlength="3">
                                                <div class="invalid-feedback" id="cardCVVError">CVV debe tener 3 d√≠gitos</div>
                                            </div>
                                            <div class="col-12 mb-3">
                                                <label class="form-label">Nombre en la Tarjeta</label>
                                                <input type="text" class="form-control" id="cardName" placeholder="Como aparece en la tarjeta">
                                                <div class="invalid-feedback" id="cardNameError">Por favor ingresa el nombre en la tarjeta</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Informaci√≥n de transferencia (oculta por defecto) -->
                                <div class="row mb-3 d-none" id="transferForm">
                                    <div class="col-12">
                                        <div class="alert alert-info">
                                            <h6>Instrucciones para Transferencia</h6>
                                            <p class="mb-2"><strong>Banco:</strong> Banco Nacional</p>
                                            <p class="mb-2"><strong>Cuenta:</strong> 1234567890</p>
                                            <p class="mb-2"><strong>Titular:</strong> Helader√≠a Deliciosa S.A.</p>
                                            <p class="mb-2"><strong>RUT:</strong> 12.345.678-9</p>
                                            <p class="mb-0"><strong>Email para confirmaci√≥n:</strong> pagos@heladeriadeliciosa.cl</p>
                                        </div>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-12 text-center">
                                        <small class="text-muted">Tus datos est√°n protegidos con encriptaci√≥n SSL</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Informaci√≥n de env√≠o -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border">
                            <div class="card-header bg-light">
                                <h5 class="mb-0">üöö Informaci√≥n de Env√≠o</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-12 col-md-6 mb-3">
                                        <label class="form-label">Direcci√≥n</label>
                                        <input type="text" class="form-control" id="address" value="Calle Principal 123">
                                        <div class="invalid-feedback">Por favor ingresa tu direcci√≥n</div>
                                    </div>
                                    <div class="col-12 col-md-6 mb-3">
                                        <label class="form-label">Ciudad</label>
                                        <input type="text" class="form-control" id="city" value="Santiago">
                                        <div class="invalid-feedback">Por favor ingresa tu ciudad</div>
                                    </div>
                                    <div class="col-12 col-md-6 mb-3">
                                        <label class="form-label">Regi√≥n</label>
                                        <input type="text" class="form-control" id="region" value="Regi√≥n Metropolitana">
                                        <div class="invalid-feedback">Por favor ingresa tu regi√≥n</div>
                                    </div>
                                    <div class="col-12 col-md-6 mb-3">
                                        <label class="form-label">C√≥digo Postal</label>
                                        <input type="text" class="form-control" id="postalCode" value="1234567">
                                        <div class="invalid-feedback">Por favor ingresa tu c√≥digo postal</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Confirmaci√≥n del pago -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card bg-light border">
                            <div class="card-body text-center">
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="termsCheck">
                                        <label class="form-check-label" for="termsCheck">
                                            Acepto los <a href="#">t√©rminos y condiciones</a> y la <a href="#">pol√≠tica de privacidad</a>
                                        </label>
                                    </div>
                                    <div class="invalid-feedback text-center mt-1" id="termsError">Debes aceptar los t√©rminos y condiciones</div>
                                </div>
                                <div class="mb-3">
                                    <p class="text-muted">Al completar tu compra, aceptas nuestras condiciones de env√≠o y devoluci√≥n.</p>
                                </div>
                                <div class="d-flex justify-content-center gap-3 flex-wrap">
                                    <a href="b12_editar_carrito.html" class="btn btn-outline-secondary">Volver al Carrito</a>
                                    <button class="btn btn-primary" onclick="processPayment()">Pagar Ahora</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer / Informaci√≥n adicional -->
                <div class="row">
                    <div class="col-12 text-center text-muted small">
                        <p>¬øNecesitas ayuda? Cont√°ctanos al +56 9 1234 5678 o escribe a ayuda@heladeriadeliciosa.cl</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Funci√≥n para generar n√∫mero de pedido aleatorio
        function generarNumeroPedido() {
            const prefijos = ['HD', 'OR', 'PX', 'AC', 'ZT'];
            const prefijo = prefijos[Math.floor(Math.random() * prefijos.length)];
            const numero = Math.floor(100000 + Math.random() * 900000);
            return `${prefijo}-${numero}`;
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadOrderSummary();
            setupPaymentMethods();
            
            // Generar n√∫mero de pedido aleatorio
            document.getElementById('orderNumber').textContent = generarNumeroPedido();
            document.getElementById('orderDate').textContent = new Date().toLocaleDateString();
        });

        function loadOrderSummary() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const shipping = subtotal > 20000 ? 0 : 2000; // Env√≠o gratis sobre $20.000
            const total = subtotal + shipping;

            document.getElementById('orderSubtotal').textContent = subtotal.toLocaleString();
            document.getElementById('orderShipping').textContent = shipping.toLocaleString();
            document.getElementById('orderTotal').textContent = total.toLocaleString();
        }

        function setupPaymentMethods() {
            // Mostrar/ocultar formularios seg√∫n m√©todo de pago seleccionado
            document.querySelectorAll('input[name="metodoPago"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    const creditCardForm = document.getElementById('creditCardForm');
                    const transferForm = document.getElementById('transferForm');
                    
                    if (this.id === 'bancoLocal' || this.id === 'tarjetaLocal') {
                        creditCardForm.classList.remove('d-none');
                        transferForm.classList.add('d-none');
                    } else if (this.id === 'transferencia') {
                        creditCardForm.classList.add('d-none');
                        transferForm.classList.remove('d-none');
                    } else {
                        creditCardForm.classList.add('d-none');
                        transferForm.classList.add('d-none');
                    }
                });
            });

            // Formatear n√∫mero de tarjeta
            const cardNumberInput = document.getElementById('cardNumber');
            if (cardNumberInput) {
                cardNumberInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
                    let matches = value.match(/\d{4,16}/g);
                    let match = matches && matches[0] || '';
                    let parts = [];
                    
                    for (let i=0, len=match.length; i<len; i+=4) {
                        parts.push(match.substring(i, i+4));
                    }
                    
                    if (parts.length) {
                        e.target.value = parts.join(' ');
                    } else {
                        e.target.value = value;
                    }
                    
                    // Validaci√≥n en tiempo real
                    if (value.length >= 16) {
                        e.target.classList.remove('is-invalid');
                    }
                });
            }

            // Formatear fecha de vencimiento
            const expiryInput = document.getElementById('cardExpiry');
            if (expiryInput) {
                expiryInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length >= 2) {
                        e.target.value = value.slice(0,2) + '/' + value.slice(2,4);
                    }
                    
                    // Validaci√≥n en tiempo real
                    if (value.length === 4) {
                        e.target.classList.remove('is-invalid');
                    }
                });
            }

            // Validaci√≥n CVV
            const cvvInput = document.getElementById('cardCVV');
            if (cvvInput) {
                cvvInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    e.target.value = value;
                    
                    if (value.length === 3) {
                        e.target.classList.remove('is-invalid');
                    }
                });
            }

            // Validaci√≥n nombre en tarjeta
            const nameInput = document.getElementById('cardName');
            if (nameInput) {
                nameInput.addEventListener('input', function(e) {
                    if (e.target.value.length > 0) {
                        e.target.classList.remove('is-invalid');
                    }
                });
            }
        }

        function validateForm() {
            let isValid = true;
            
            // Validar t√©rminos y condiciones
            const termsCheck = document.getElementById('termsCheck');
            if (!termsCheck.checked) {
                document.getElementById('termsError').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('termsError').style.display = 'none';
            }
            
            // Validar informaci√≥n de tarjeta si est√° seleccionada
            const selectedPayment = document.querySelector('input[name="metodoPago"]:checked').id;
            if (selectedPayment === 'bancoLocal' || selectedPayment === 'tarjetaLocal') {
                // Validar n√∫mero de tarjeta
                const cardNumber = document.getElementById('cardNumber').value.replace(/\s/g, '');
                if (cardNumber.length < 16) {
                    document.getElementById('cardNumberError').style.display = 'block';
                    document.getElementById('cardNumber').classList.add('is-invalid');
                    isValid = false;
                } else {
                    document.getElementById('cardNumberError').style.display = 'none';
                    document.getElementById('cardNumber').classList.remove('is-invalid');
                }
                
                // Validar fecha de vencimiento
                const cardExpiry = document.getElementById('cardExpiry').value;
                if (!/^\d{2}\/\d{2}$/.test(cardExpiry)) {
                    document.getElementById('cardExpiryError').style.display = 'block';
                    document.getElementById('cardExpiry').classList.add('is-invalid');
                    isValid = false;
                } else {
                    document.getElementById('cardExpiryError').style.display = 'none';
                    document.getElementById('cardExpiry').classList.remove('is-invalid');
                }
                
                // Validar CVV
                const cardCVV = document.getElementById('cardCVV').value;
                if (cardCVV.length !== 3) {
                    document.getElementById('cardCVVError').style.display = 'block';
                    document.getElementById('cardCVV').classList.add('is-invalid');
                    isValid = false;
                } else {
                    document.getElementById('cardCVVError').style.display = 'none';
                    document.getElementById('cardCVV').classList.remove('is-invalid');
                }
                
                // Validar nombre en tarjeta
                const cardName = document.getElementById('cardName').value;
                if (cardName.trim().length === 0) {
                    document.getElementById('cardNameError').style.display = 'block';
                    document.getElementById('cardName').classList.add('is-invalid');
                    isValid = false;
                } else {
                    document.getElementById('cardNameError').style.display = 'none';
                    document.getElementById('cardName').classList.remove('is-invalid');
                }
            }
            
            return isValid;
        }

        function processPayment() {
            if (!validateForm()) {
                return;
            }

            // Guardar informaci√≥n del pedido para la confirmaci√≥n
            const orderData = {
                orderNumber: document.getElementById('orderNumber').textContent,
                paymentMethod: document.querySelector('input[name="metodoPago"]:checked').id,
                total: document.getElementById('orderTotal').textContent,
                address: document.getElementById('address').value,
                city: document.getElementById('city').value,
                region: document.getElementById('region').value,
                postalCode: document.getElementById('postalCode').value
            };
            
            localStorage.setItem('lastOrder', JSON.stringify(orderData));

            // Simular procesamiento de pago
            const paymentMethod = document.querySelector('input[name="metodoPago"]:checked').id;
            let paymentMessage = '';
            
            switch(paymentMethod) {
                case 'bancoLocal':
                case 'tarjetaLocal':
                    paymentMessage = 'Procesando pago con tarjeta...';
                    break;
                case 'transferencia':
                    paymentMessage = 'Redirigiendo a Mercado Pago...';
                    break;
                case 'efectivo':
                    paymentMessage = 'Preparando pedido para pago en efectivo...';
                    break;
            }

            // Mostrar mensaje de procesamiento
            alert(paymentMessage);
            
            // Simular delay de procesamiento
            setTimeout(() => {
                // Limpiar carrito
                localStorage.removeItem('cart');
                
                // Redirigir a p√°gina de confirmaci√≥n
                window.location.href = 'b14_confirmacion_pago.html';
            }, 2000);
        }
    </script>
</body>
</html>